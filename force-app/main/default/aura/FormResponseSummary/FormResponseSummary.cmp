<aura:component controller="FormController" implements="flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickActionwithoutheader,lightning:actionOverride">

    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name="detail" type="Object" default="{}" />
    <aura:attribute name="form" type="Clarity_Form__c" />
    <aura:attribute name="responses" type ="list"/>
    <aura:attribute name="data" type="Object"/>
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="loading" type="Boolean"/>

    <div class="slds-page-header slds-page-header_record-home">
        <div class="slds-page-header__row">
            <div class="slds-page-header__col-title">
                <div class="slds-media">
                    <div class="slds-media__figure">
                        <lightning:icon iconName="standard:template" alternativeText="Clarity Forms" />
                    </div>
                <div class="slds-media__body">
                    <div class="slds-page-header__name">
                        <div class="slds-page-header__name-title">
                            <h1>
                                <span>Clarity Form</span>
                                <span class="slds-page-header__title slds-truncate" title="{!v.form.Name}">{!v.form.Name}</span>
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="slds-page-header__col-actions">
            <div class="slds-page-header__controls">
                <div class="slds-page-header__control">
                    <lightning:buttonGroup>

                        <aura:if isTrue="{!v.form.Status__c == 'Published'}">
                            <lightning:button label="New Form Response" onclick="{!c.handleNewFormResponse}" />
                            <aura:set attribute="else">
                                <lightning:button label="Publish Form" onclick="{!c.handlePublishForm}" />
                            </aura:set>
                        </aura:if>

                        <lightning:button iconName="utility:insert_template" onclick="{!c.edit}" label="Form Builder" />
                        <lightning:button iconName="action:clone" label="Clone" onclick="{!c.clone}" />
                        <lightning:button iconName="action:delete" label="Delete" onclick="{!c.delete}" />
                    </lightning:buttonGroup>
                </div>
            </div>
        </div>
    </div>
    <div class="slds-page-header__row slds-page-header__row_gutters">
        <div class="slds-page-header__col-details">
            <ul class="slds-page-header__detail-row">
                <li class="slds-page-header__detail-block">
                    <div class="slds-text-title slds-truncate" title="Status">Status</div>
                    <div class="slds-truncate" title="Draft">{!v.form.Status__c}</div>
                </li>            
            </ul>
        </div>
    </div>

    </div>
 
    <div class="slds-m-top_x-small slds-tabs_card slds-tabs_card slds-tabs_card">
        <lightning:tabset selectedTabId="responses">
            <lightning:tab label="Responses" id="responses">
                <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
                    <thead>
            
                        <tr class="slds-line-height_reset">
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Name">Name</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Status">Status</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Completed">Questions Complete</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Start Date">Start Date</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Submitted Date">Submitted Date</div>
                            </th> 
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Actions">Actions</div>
                            </th>
            
                        </tr>
            
                    </thead>
                    <tbody>
            
                        <aura:if isTrue="{! v.loading }">
                            <lightning:spinner variant="brand" size="small" alternativeText="Loading" />
                            <aura:set attribute="else">
                                <aura:iteration items="{!v.data}" var="response">
                                    <tr>
                                        <td data-label="Name">
                                            <div class="slds-truncate" title="{!response.name}">{!response.name}</div>
                                        </td>
                                        <td data-label="Status">
                                            <div class="slds-truncate" title="{!response.status}">{!response.status}</div>
                                        </td>
                                        <td data-label="Completed">
                                            <div class="slds-truncate" title="{!response.completed}">{!response.completed}</div>
                                        </td>
                                        <td data-label="Start Date">
                                            <div class="slds-truncate" title="{!response.start}">{!response.start}</div>
                                        </td>
                                        <td data-label="Submitted Date">
                                            <div class="slds-truncate" title="{!response.submittedDate}">{!response.submittedDate}</div>
                                        </td>
                                            
                                        <td data-label="Action">
                                            <div class="slds-truncate" title="">

                                                <lightning:button disabled="{!response.status == 'New'}" variant="brand" label="View" value="{!response.id}" onclick="{!c.handleNewFormResponseTab}" />
                                                <lightning:button disabled="{!response.status == 'Submitted'}" label="Edit" value="{!response.id}" onclick="{!c.handleEditFormResponse}" />
                                                <lightning:button label="Delete" value="{!response.id}" variant="destructive" onclick="{!c.handleDeleteFormResponse}" />    

                                            </div>
                                        </td>
                    
                                    </tr>
                                </aura:iteration>
                            </aura:set>
                        </aura:if>
            
                    </tbody>
    
                </table>
            </lightning:tab>
            <lightning:tab label="Timeline" id="timeline">
                Timeline
            </lightning:tab>
        </lightning:tabset>
    </div>
    
    
    <lightning:navigation aura:id="navService"/>
    <lightning:overlayLibrary aura:id="overlayLib"/>

</aura:component>